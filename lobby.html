<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lobby - Last Man Standing</title>
  <link rel="stylesheet" href="css/lobby.css">
  <link rel="icon" href="favicon.ico" sizes="any">
  <meta name="theme-color" content="#8b27c4">

  <!-- Redirect GitHub Pages -> Render (preserve path/query/hash, remove /last-man-standing prefix) -->
  <script>
    (function(){
      try {
        var ghHosts = ['pixeloverkilll.github.io', 'www.pixeloverkilll.github.io'];
        var host = window.location.hostname;
        if (ghHosts.indexOf(host) !== -1) {
          var targetHost = 'last-man-standing-1.onrender.com';
          var path = window.location.pathname || '/';
          if (path.indexOf('/last-man-standing') === 0) {
            path = path.replace('/last-man-standing', '') || '/';
          }
          var newUrl = window.location.protocol + '//' + targetHost + path + window.location.search + window.location.hash;
          if (window.location.hostname !== targetHost) {
            window.location.replace(newUrl);
          }
        }
      } catch (e) { /* fail silently */ }
    })();
  </script>

  <!-- Configuration Script (must be loaded before socket-client) -->
  <script src="config.js"></script>

  <!-- PeerJS f√ºr P2P-Verbindung -->
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

  <!-- Dynamically load socket.io client like index.html (CDN for production to avoid ORB) -->
  <script>
    (function() {
      try {
        var socketScript = '/socket.io/socket.io.js';
        if (typeof CONFIG !== 'undefined' && CONFIG && CONFIG.ENV === 'production' && typeof CONFIG.getSocketUrl === 'function') {
          socketScript = 'https://cdn.socket.io/4.7.2/socket.io.min.js';
        }
      } catch (e) {
        var socketScript = '/socket.io/socket.io.js';
      }

      function loadScript(src, cb) {
        var s = document.createElement('script');
        s.src = src;
        s.async = false;
        s.onload = cb || function(){};
        s.onerror = function(err) { console.error('Failed to load script', src, err); cb && cb(err); };
        document.head.appendChild(s);
      }

      // Load socket.io client, then our socket-client
      loadScript(socketScript, function(err) {
        if (err) {
          console.warn('socket.io client failed to load from', socketScript, ' ‚Äî socket-client may not work');
        }
        loadScript('js/socket-client.js');
      });
    })();
  </script>

  <!-- Fallback f√ºr PeerJS -->
  <script>
    // Pr√ºfe ob PeerJS geladen wurde, ansonsten lade alternative Version
    window.addEventListener('DOMContentLoaded', function() {
      if (typeof Peer === 'undefined') {
        console.warn('‚ö†Ô∏è PeerJS nicht gefunden, lade Alternative...');
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js';
        script.onerror = function() {
          console.error('‚ùå PeerJS konnte nicht geladen werden!');
          alert('Fehler: P2P-Bibliothek konnte nicht geladen werden. Bitte Seite neu laden oder √ºberpr√ºfen Sie Ihre Internetverbindung.');
        };
        script.onload = function() {
          console.log('‚úÖ PeerJS Fallback erfolgreich geladen');
        };
        document.head.appendChild(script);
      } else {
        console.log('‚úÖ PeerJS erfolgreich geladen');
      }
    });
  </script>
</head>
<body>

  <!-- Host Info (Top Left) -->
  <div class="host-info">
    <div class="host-label">üëë HOST</div>
    <div class="host-card">
      <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Host" alt="Host Avatar" class="host-avatar" id="host-avatar">
      <div class="host-name" id="host-name">Host l√§dt...</div>
    </div>
  </div>

  <!-- Action Buttons (Top Right) -->
  <button class="leave-lobby-btn" id="leave-lobby-btn" title="Lobby verlassen">
    <span class="leave-icon">üö™</span>
  </button>
  <button class="fullscreen-btn" id="fullscreen-btn" title="Vollbild">
    <span>‚õ∂</span>
  </button>

  <!-- Main Content -->
  <div class="quiz-container">
    <div class="quiz-header">
      <h1 class="quiz-title">Last Man Standing</h1>
      <div class="lobby-code-display" id="lobby-code-container">
        <span class="code-label">Lobby-Code:</span>
        <code class="code-value" id="lobby-code-display">------</code>
        <input type="text" id="lobby-code-copy" readonly style="margin-left:10px;width:120px;">
        <button onclick="copyLobbyCode()" id="copy-code-btn">Code kopieren</button>
      </div>
      <div class="join-lobby-area" style="margin-top:20px;">
        <label for="join-code-input">Lobby-Code eingeben:</label>
        <input type="text" id="join-code-input" maxlength="8" style="width:120px;">
        <button onclick="joinLobbyByInput()" id="join-lobby-btn">Lobby beitreten</button>
      </div>
    </div>

    <div class="question-area">
      <div class="waiting-message">
        <div class="spinner"></div>
        <h2>Warte auf Spieler...</h2>
        <p>Teile den Lobby-Code mit deinen Freunden!</p>
      </div>

      <!-- Host Controls -->
      <div class="host-controls" id="host-controls" style="display: none;">
        <button class="btn btn-start" id="start-quiz-btn">
          <span class="btn-icon">‚ñ∂Ô∏è</span>
          Quiz starten
        </button>
      </div>
    </div>
  </div>

  <!-- Players Area (Bottom) -->
  <div class="players-area">
    <div class="players-container" id="players-container">
      <!-- Players werden hier dynamisch hinzugef√ºgt -->
    </div>
  </div>

  <!-- Neue Buttons -->
  <div class="button-container" id="host-eval-buttons" style="display: none;" aria-hidden="true">
    <button class="btn btn-correct" id="btn-correct" title="Richtig">
      <span class="btn-icon">‚úîÔ∏è</span>
    </button>
    <button class="btn btn-wrong" id="btn-wrong" title="Falsch">
      <span class="btn-icon">‚ùå</span>
    </button>
  </div>

  <script src="js/lobby.js"></script>
</body>
</html>
